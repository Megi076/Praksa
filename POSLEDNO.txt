using Microsoft.AspNetCore.Localization;
using Microsoft.Extensions.Options;
using System.Globalization;
using System.Threading;

var builder = WebApplication.CreateBuilder(args);

// ???????? ?? ???????? ?? ????????????
builder.Services.AddLocalization(options => options.ResourcesPath = "Resources");

// ????????? ???????
var supportedCultures = new[] { "mk", "en", "sr" };
var defaultCulture = "mk";  // ??????????? ?? ????????? ?? ??????

// ????????????? ?? RequestLocalizationOptions
builder.Services.Configure<RequestLocalizationOptions>(options =>
{
    options.DefaultRequestCulture = new RequestCulture(defaultCulture);  // ??????? ?? ??????
    options.SupportedCultures = supportedCultures.Select(c => new CultureInfo(c)).ToList();  // ????????? ???????
    options.SupportedUICultures = supportedCultures.Select(c => new CultureInfo(c)).ToList();  // ????????? UI ???????
});

builder.Services.AddRazorPages();
builder.Services.AddServerSideBlazor();
builder.Services.AddScoped<HttpClient>(sp =>
    new HttpClient { BaseAddress = new Uri("http://localhost:5098") });

var app = builder.Build();

// Middleware ?? ????????????
var localizationOptions = app.Services.GetRequiredService<IOptions<RequestLocalizationOptions>>().Value;
app.UseRequestLocalization(localizationOptions);

// ???????? ??????? ? ????????
app.UseStaticFiles();
app.UseRouting();

// ???????? ?? ?????????? ?? ???????
app.MapControllers();

// ???????? ?? Blazor Hub
app.MapBlazorHub();

// ??????????? ?? fallback ????????
app.MapFallbackToPage("/_Host");

// ????????? ????????? ?? ????????? ????? (?.?. ????????)
var requestCulture = new RequestCulture(defaultCulture);
CultureInfo.CurrentCulture = requestCulture.Culture;
CultureInfo.CurrentUICulture = requestCulture.UICulture;
Thread.CurrentThread.CurrentCulture = requestCulture.Culture;
Thread.CurrentThread.CurrentUICulture = requestCulture.UICulture;

app.Run(); 



@inherits LayoutComponentBase
@using BlazorAppPaginationClient.Shared

<PageTitle>BlazorAppPaginationClient</PageTitle>

<div class="page">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main>
        <div class="top-row px-4" style="display: flex; justify-content: space-between; align-items: center;">
            <a href="https://docs.microsoft.com/aspnet/" target="_blank">About</a>
            <LanguageSelector />
        </div>

        <article class="content px-4">
            @Body
        </article>
    </main>
</div>   

paginated data 


@page "/taxiridesapp"
@using BlazorAppPaginationClient.Models
@using System.Text
@inject IJSRuntime JSRuntime
@inject HttpClient Http
@inject IStringLocalizer<SharedResource> L
@inject NavigationManager NavigationManager
@using BlazorAppPaginationClient.Resources
@using Microsoft.Extensions.Localization


<h3>@L["TaxiRides"]</h3>

<div class="controls-container">
    <div class="search-box">
        <label>@L["SearchLabel"]</label>
        <input type="text" @bind="SearchText" @bind:event="oninput" placeholder="@L["SearchPlaceholder"]" class="search-input" />
    </div>
    <div class="page-size-selector">
        <label>@L["PageSize"]</label>
        <select @bind="PageSize" @bind:event="onchange" class="dropdown">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
            <option value="100">100</option>
        </select>
    </div>
    <div class="total-records">
        <strong>@L["TotalRecords"] @FilteredRecords</strong>
    </div>
   
</div>

@if (TaxiRecords == null)
{
    <p>@L["Loading"]...</p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>#</th>
                @foreach (var property in typeof(TaxiRecord).GetProperties())
                {
                    <th @onclick="() => SortByColumn(property.Name)" class="sortable">
                        @property.Name @GetSortIndicator(property.Name)
                    </th>
                }
            </tr>
        </thead>
        <tbody>
            @foreach (var (ride, index) in PaginatedRides.Select((r, i) => (r, i + 1 + ((_currentPage - 1) * PageSize))))
            {
                <tr>
                    <td>@index</td>
                    @foreach (var property in typeof(TaxiRecord).GetProperties())
                    {
                        <td>@property.GetValue(ride)</td>
                    }
                </tr>
            }
        </tbody>
    </table>

    <div class="pagination-container">
        <button @onclick="PreviousPage" disabled="@(_currentPage == 1)" class="pagination-button">@L["Previous"]</button>
        <span>@L["Page"] @_currentPage @L["Of"] @TotalPages</span>
        <button @onclick="NextPage" disabled="@(_currentPage >= TotalPages)" class="pagination-button">@L["Next"]</button>
    </div>

    <div class="page-input-container">
        <label>@L["EnterPage"]</label>
        <input type="number" @bind="EnteredPage" class="page-input" />
        <button @onclick="GoToPage" class="pagination-button">@L["Go"]</button>
    </div>

    <div class="export-buttons">
        <button class="btn btn-primary" @onclick="ExportToCsv">@L["ExportCsv"]</button>
        <button class="btn btn-success" @onclick="ExportToExcel">@L["ExportExcel"]</button>
        <button class="btn btn-danger" @onclick="ExportToPdf">@L["ExportPdf"]</button>
    </div>
}

<style>
    .controls-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        gap: 10px;
    }

    .search-input, .dropdown, .page-input {
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

        .table th, .table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

    .sortable:hover {
        cursor: pointer;
        background-color: #f1f1f1;
    }

    .pagination-container, .page-input-container {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 10px;
        gap: 10px;
    }

    .pagination-button {
        padding: 5px 10px;
        border: none;
        background-color: #007bff;
        color: white;
        border-radius: 5px;
        cursor: pointer;
    }

        .pagination-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

    .export-buttons {
        margin-top: 15px;
        text-align: center;
    }
</style>

@code {
    private List<TaxiRecord> TaxiRecords = new();
    private string SearchText = "";
    private int _currentPage = 1;
    private int PageSize = 10;
    private int EnteredPage;
    private int TotalRecords = 0;
    private int FilteredRecords => FilteredRides.Count;
    private int TotalPages => (int)Math.Ceiling((double)FilteredRecords / PageSize);

    private string SortColumn = nameof(TaxiRecord.pickupTime);
    private bool SortAscending = true;

    private List<TaxiRecord> FilteredRides =>
        string.IsNullOrWhiteSpace(SearchText)
        ? TaxiRecords
        : TaxiRecords.Where(r => typeof(TaxiRecord).GetProperties()
            .Any(p => p.GetValue(r)?.ToString()?.Contains(SearchText, StringComparison.OrdinalIgnoreCase) == true)).ToList();

    private List<TaxiRecord> PaginatedRides =>
        FilteredRides
        .OrderBy(r => SortAscending ? GetPropertyValue(r, SortColumn) : null)
        .ThenByDescending(r => SortAscending ? null : GetPropertyValue(r, SortColumn))
        .Skip((_currentPage - 1) * PageSize)
        .Take(PageSize)
        .ToList();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            TaxiRecords = await Http.GetFromJsonAsync<List<TaxiRecord>>("http://localhost:5098/api/TaxiRides/GetTaxiRides2");
            TotalRecords = TaxiRecords.Count;
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error: {ex.Message}");
        }
    }

    private void NextPage()
    {
        if (_currentPage < TotalPages) _currentPage++;
    }

    private void PreviousPage()
    {
        if (_currentPage > 1) _currentPage--;
    }

    private void GoToPage()
    {
        if (EnteredPage >= 1 && EnteredPage <= TotalPages)
        {
            _currentPage = EnteredPage;
        }
    }

    private void SortByColumn(string columnName)
    {
        if (SortColumn == columnName)
        {
            SortAscending = !SortAscending;
        }
        else
        {
            SortColumn = columnName;
            SortAscending = true;
        }
    }

    private string GetSortIndicator(string columnName)
    {
        if (SortColumn == columnName)
        {
            return SortAscending ? "‚ñ≤" : "‚ñº";
        }
        return "";
    }

    private object GetPropertyValue(TaxiRecord ride, string propertyName)
    {
        var property = typeof(TaxiRecord).GetProperty(propertyName);
        return property?.GetValue(ride, null);
    }

    private async Task ExportToCsv()
    {
        var csvContent = GenerateCsvContent(PaginatedRides);
        await JSRuntime.InvokeVoidAsync("saveAsFile", "taxi_rides.csv", csvContent);
    }

    private async Task ExportToExcel()
    {
        var excelContent = GenerateExcelContent(PaginatedRides);
        await JSRuntime.InvokeVoidAsync("saveExcel", "taxi_rides.xlsx", excelContent);
    }

    private async Task ExportToPdf()
    {
        var pdfContent = GeneratePdfContent(PaginatedRides);
        await JSRuntime.InvokeVoidAsync("savePdf", "taxi_rides.pdf", pdfContent);
    }

    private string GenerateCsvContent(List<TaxiRecord> data)
    {
        var sb = new StringBuilder();
        sb.AppendLine("Medallion,Hash License,Pickup Time,Drop-off Time,Duration,Distance,Pickup Longitude,Pickup Latitude,Drop-off Longitude,Drop-off Latitude,Payment Type,Fare Amount,Surcharge,Tax,Tip Amount,Tolls Amount,Total Amount");

        foreach (var item in data)
        {
            sb.AppendLine($"{item.medallion},{item.hashLicense},{item.pickupTime},{item.dropOffTime},{item.duration},{item.distance},{item.pLongitude},{item.pLatitude},{item.dLongitude},{item.dLatitude},{item.paymentType},{item.fareAmount},{item.surcharge},{item.tax},{item.tipAmount},{item.tollsAmount},{item.totalAmount}");
        }

        return sb.ToString();
    }

    private object GenerateExcelContent(List<TaxiRecord> data)
    {
        var sheet = new List<List<object>> {
            new List<object> { "Medallion", "Hash License", "Pickup Time", "Drop-off Time", "Duration", "Distance", "Pickup Longitude", "Pickup Latitude", "Drop-off Longitude", "Drop-off Latitude", "Payment Type", "Fare Amount", "Surcharge", "Tax", "Tip Amount", "Tolls Amount", "Total Amount" }
        };

        foreach (var item in data)
        {
            sheet.Add(new List<object> { item.medallion, item.hashLicense, item.pickupTime, item.dropOffTime, item.duration, item.distance, item.pLongitude, item.pLatitude, item.dLongitude, item.dLatitude, item.paymentType, item.fareAmount, item.surcharge, item.tax, item.tipAmount, item.tollsAmount, item.totalAmount });
        }

        return sheet;
    }

    private string GeneratePdfContent(List<TaxiRecord> data)
    {
        var content = "Taxi Ride Data:\n\n";
        foreach (var item in data)
        {
            content += $"Medallion: {item.medallion}, Hash License: {item.hashLicense}, Pickup: {item.pickupTime}, Drop-off: {item.dropOffTime}, Total Amount: {item.totalAmount}\n";
        }
        return content;
    }

    private async Task OnLanguageChange(ChangeEventArgs e)
    {
        var selectedCulture = e.Value?.ToString() ?? "en";
        var uri = new Uri(NavigationManager.Uri).GetComponents(UriComponents.PathAndQuery, UriFormat.Unescaped);
        var newUri = $"{uri}?culture={selectedCulture}&ui-culture={selectedCulture}";
        NavigationManager.NavigateTo(newUri, forceLoad: true);
    }
}  

****

‚îú‚îÄ‚îÄ SharedResource.cs              # –û—Å–Ω–æ–≤–Ω–∞ –∫–ª–∞—Å–∞ –∑–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—ò–∞
‚îÇ   ‚îú‚îÄ‚îÄ SharedResource.mk.resx   # –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—ò–∞ –∑–∞ –º–∞–∫–µ–¥–æ–Ω—Å–∫–∏ 
‚îÇ   ‚îú‚îÄ‚îÄ SharedResource.en.resx  # –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—ò–∞ –∑–∞ –∞–Ω–≥–ª–∏—Å–∫–∏ 
‚îÇ   ‚îî‚îÄ‚îÄ SharedResource.sr.resx  # –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—ò–∞ –∑–∞ —Å—Ä–ø—Å–∫–∏   

/YourProject
‚îú‚îÄ‚îÄ /Resources
‚îÇ   ‚îú‚îÄ‚îÄ SharedResource.cs             # –û—Å–Ω–æ–≤–Ω–∞ –∫–ª–∞—Å–∞ –∑–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—ò–∞
‚îÇ   ‚îú‚îÄ‚îÄ SharedResource.mk.resx        # –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—ò–∞ –∑–∞ –º–∞–∫–µ–¥–æ–Ω—Å–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ SharedResource.en.resx        # –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—ò–∞ –∑–∞ –∞–Ω–≥–ª–∏—Å–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ SharedResource.sr.resx        # –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—ò–∞ –∑–∞ —Å—Ä–ø—Å–∫–∏ 

znaci program.cs, SharedResource i resx fajlovi, PaginatedData.razor i _Host.cshtml 
tuka treba da se primeni lokalizacijata

Host.cshtml 
@page "/"
@namespace BlazorAppPaginationClient
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="@Thread.CurrentThread.CurrentUICulture.TwoLetterISOLanguageName">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BlazorAppPaginationClient</title>
    <base href="~/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link href="css/site.css" rel="stylesheet" />
    <link href="BlazorAppPaginationClient.styles.css" rel="stylesheet" />
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
    <script src="js/site.js"></script>
    <script src="_framework/blazor.server.js"></script>
</head>
<body>
    <component type="typeof(App)" render-mode="ServerPrerendered" />

    <div id="blazor-error-ui">
        <environment include="Staging,Production">
            An error has occurred. This application may no longer respond until reloaded.
        </environment>
        <environment include="Development">
            An unhandled exception has occurred. See browser dev tools for details.
        </environment>
        <a href="" class="reload">Reload</a>
        <a class="dismiss">üóô</a>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—ò–∞ –∑–∞ –∏–∑–≤–æ–∑ –Ω–∞ —Ç–∞–±–µ–ª–∞ –≤–æ —Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–µ–Ω PDF
        function exportTableToPdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape'); // –ü–æ—Å—Ç–∞–≤—É–≤–∞—ö–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—ò–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞ –Ω–∞ "landscape"

            // –î–æ–¥–∞–≤–∞—ö–µ –Ω–∞—Å–ª–æ–≤ –∏–ª–∏ –¥—Ä—É–≥–∞ —Å–æ–¥—Ä–∂–∏–Ω–∞
            doc.text("Taxi Rides List", 14, 16); // –ú–æ–∂–µ –¥–∞ –≥–æ –ø—Ä–æ–º–µ–Ω–∏—à –Ω–∞ —à—Ç–æ —Ç–∏ —Ç—Ä–µ–±–∞

            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–∞—ö–µ –Ω–∞ HTML —Ç–∞–±–µ–ª–∞ –≤–æ PDF
            doc.autoTable({
                html: '.table', // –ü—Ä–æ–º–µ–Ω–µ—Ç–µ –≥–æ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ—Ç –∑–∞ —Ç–∞–±–µ–ª–∞—Ç–∞ –∞–∫–æ –µ –ø–æ—Ç—Ä–µ–±–Ω–æ
                startY: 30,  // –ü–æ—Å—Ç–∞–≤–µ—Ç–µ –≥–æ –ø–æ—á–µ—Ç–Ω–∏–æ—Ç Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ω–∞ —Ç–∞–±–µ–ª–∞—Ç–∞
                margin: { top: 20 },  // –ü–æ—Å—Ç–∞–≤–µ—Ç–µ –º–∞—Ä–≥–∏–Ω–∏ –∞–∫–æ —Ç—Ä–µ–±–∞
                theme: 'grid',  // –í–∏–∑—É–µ–ª–Ω–∞ —Ç–µ–º–∞ –∑–∞ —Ç–∞–±–µ–ª–∞—Ç–∞
                columnStyles: {
                    0: { cellWidth: 10 },
                    1: { cellWidth: 20 },
                    2: { cellWidth: 20 },
                    3: { cellWidth: 20 },
                    6: { cellWidth: 20 },
                    5: { cellWidth: 20 },
                    4: { cellWidth: 20 },
                    7: { cellWidth: 20 },
                    8: { cellWidth: 20 },
                    9: { cellWidth: 20 },
                    10: { cellWidth: 20 },
                    11: { cellWidth: 20 },
                    12: { cellWidth: 20 },
                    13: { cellWidth: 20 },
                    14: { cellWidth: 20 },
                    15: { cellWidth: 20 },
                    16: { cellWidth: 20 }
                }
            });

            // –ü—Ä–µ–∑–µ–º–∞—ö–µ –Ω–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–æ—Ç–æ PDF
            doc.save('taxi_rides_list.pdf');
        }

        // –§—É–Ω–∫—Ü–∏—ò–∞ –∑–∞ –∏–∑–≤–æ–∑ –≤–æ Excel
        function exportToExcel(paginatedData, filename = 'taxi_rides.xlsx') {
            if (!paginatedData || paginatedData.length === 0) {
                console.error("No data to export");
                return;
            }

            // –ü—Ä–µ—Ç–≤–æ—Ä–∏ –≥–æ –ø–æ–¥–∞—Ç–æ–∫–æ—Ç –≤–æ Excel —Ñ–æ—Ä–º–∞—Ç
            const ws = XLSX.utils.json_to_sheet(paginatedData);
            const wb = XLSX.utils.book_new();           // –ö—Ä–µ–∏—Ä–∞—ò –Ω–æ–≤ Excel –¥–æ–∫—É–º–µ–Ω—Ç
            XLSX.utils.book_append_sheet(wb, ws, 'Taxi Rides'); // –î–æ–¥–∞–¥–∏ –≥–æ –ª–∏—Å—Ç–æ—Ç —Å–æ –ø–æ–¥–∞—Ç–æ—Ü–∏
            XLSX.writeFile(wb, filename);               // –ü—Ä–µ–∑–µ–º–∏ –≥–æ Excel —Ñ–∞—ò–ª–æ—Ç
        }

        // –§—É–Ω–∫—Ü–∏—ò–∞ –∑–∞ –∏–∑–≤–æ–∑ –≤–æ CSV
        function exportToCsv(data, filename = 'taxi_rides.csv') {
            if (!data || data.length === 0) {
                alert("No data to export.");
                return;
            }

            // –ó–∞–¥–∞–≤–∞—ö–µ –Ω–∞ —Ö–µ–¥–µ—Ä –Ω–∞ CSV —Ñ–∞—ò–ª–æ—Ç
            const header = ['medallion', 'hashLicense', 'pickupTime', 'dropOffTime', 'duration', 'distance', 'pLongitude', 'pLatitude', 'dLongitude', 'dLatitude', 'paymentType', 'fareAmount', 'surcharge', 'tax', 'tipAmount', 'tollsAmount', 'totalAmount'];

            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–≤–∞—ö–µ –Ω–∞ –ø–æ–¥–∞—Ç–æ—Ü–∏—Ç–µ –≤–æ –Ω–∏–∑–∏ (row data)
            const rows = data.map(item => [
                item.medallion,
                item.hashLicense,
                item.pickupTime,
                item.dropOffTime,
                item.duration,
                item.distance,
                item.pLongitude,
                item.pLatitude,
                item.dLongitude,
                item.dLatitude,
                item.paymentType,
                item.fareAmount,
                item.surcharge,
                item.tax,
                item.tipAmount,
                item.tollsAmount,
                item.totalAmount
            ]);

            // –°–µ –¥–æ–¥–∞–≤–∞ —Ö–µ–¥–µ—Ä–æ—Ç –∫–∞–∫–æ –ø—Ä–≤ —Ä–µ–¥ –≤–æ CSV
            const csvContent = [header, ...rows].map(e => e.join(",")).join("\n");

            // –ö—Ä–µ–∏—Ä–∞—ö–µ –Ω–∞ Blob –∏ –ø—Ä–µ–∑–µ–º–∞—ö–µ –Ω–∞ CSV —Ñ–∞—ò–ª
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            if (link.download !== undefined) { // Feature detection for download attribute
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", filename);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
    </script>
</body>
</html>

PROGRAM.CS 
using Microsoft.AspNetCore.Localization;
using Microsoft.Extensions.Options;
using System.Globalization;
using System.Threading;

var builder = WebApplication.CreateBuilder(args);

// ‚úÖ –î–æ–¥–∞–≤–∞—ö–µ –Ω–∞ –ø–æ–¥–¥—Ä—à–∫–∞ –∑–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—ò–∞
builder.Services.AddLocalization(options => options.ResourcesPath = "Resources");

// ‚úÖ –ü–æ–¥–¥—Ä–∂–∞–Ω–∏ –∫—É–ª—Ç—É—Ä–∏
var supportedCultures = new[] { "mk", "en", "sr" };
var defaultCulture = "mk";  // –ö—É–ª—Ç—É—Ä–∞ –ø–æ –¥–∏—Ñ–æ–ª—Ç

// ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—ò–∞ –Ω–∞ RequestLocalizationOptions
builder.Services.Configure<RequestLocalizationOptions>(options =>
{
    options.DefaultRequestCulture = new RequestCulture(defaultCulture);
    options.SupportedCultures = supportedCultures.Select(c => new CultureInfo(c)).ToList();
    options.SupportedUICultures = supportedCultures.Select(c => new CultureInfo(c)).ToList();

    // ‚úÖ –û–í–û–à –î–ï–õ –û–í–û–ó–ú–û–ñ–£–í–ê –ö–£–õ–¢–£–†–ê –ü–†–ï–ö–£ URL (–ø—Ä–∏–º–µ—Ä: ?culture=sr)
    options.RequestCultureProviders.Insert(0, new QueryStringRequestCultureProvider());
});

builder.Services.AddRazorPages();
builder.Services.AddServerSideBlazor();
builder.Services.AddScoped<HttpClient>(sp =>
    new HttpClient { BaseAddress = new Uri("http://localhost:5098") });

var app = builder.Build();

// ‚úÖ Middleware –∑–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—ò–∞
var localizationOptions = app.Services.GetRequiredService<IOptions<RequestLocalizationOptions>>().Value;
app.UseRequestLocalization(localizationOptions);

// ‚úÖ –°—Ç–∞—Ç–∏—á–∫–∏ —Ñ–∞—ò–ª–æ–≤–∏ –∏ —Ä—É—Ç–∏—Ä–∞—ö–µ
app.UseStaticFiles();
app.UseRouting();

// ‚úÖ –ú–∞–ø–∏—Ä–∞—ö–µ –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏ (–∞–∫–æ –∏–º–∞—à API –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∏ –∏–ª–∏ –∫—É–ª—Ç—É—Ä–∞ –≤–æ —Ä—É—Ç–∏)
app.MapControllers();

// ‚úÖ –ú–∞–ø–∏—Ä–∞—ö–µ –Ω–∞ Blazor Hub
app.MapBlazorHub();

// ‚úÖ –§–æ–ª–±–µ–∫ –∑–∞ Blazor —Å—Ç—Ä–∞–Ω–∏—Ü–∏—Ç–µ
app.MapFallbackToPage("/_Host");

// ‚úÖ –°—Ç–∞—Ä—Ç—É–≤–∞—ö–µ –Ω–∞ –∞–ø–ª–∏–∫–∞—Ü–∏—ò–∞—Ç–∞
app.Run();

LANGUAGESELECTOR.RAZOR

@inject NavigationManager NavigationManager

<select @onchange="OnLanguageChanged" class="form-select">
    <option value="mk" selected="@IsSelected("mk")">–ú–∞–∫–µ–¥–æ–Ω—Å–∫–∏</option>
    <option value="en" selected="@IsSelected("en")">English</option>
    <option value="sr" selected="@IsSelected("sr")">Srpski</option>
</select>

@code {
    private async Task OnLanguageChanged(ChangeEventArgs e)
    {
        var culture = e.Value?.ToString() ?? "mk"; // –ü–æ—Å—Ç–∞–≤—É–≤–∞—ö–µ –Ω–∞ –∫—É–ª—Ç—É—Ä–∞ –ø–æ –∏–∑–±–æ—Ä
        var uri = NavigationManager.Uri;

        var newUrl = $"/culture/setculture?culture={culture}&redirectUri={Uri.EscapeDataString(uri)}"; // –ö—Ä–µ–∏—Ä–∞—ö–µ –Ω–∞ –Ω–æ–≤–æ—Ç–æ URL
        NavigationManager.NavigateTo(newUrl, forceLoad: true); // –ü—Ä–µ–Ω–∞—Å–æ—á—É–≤–∞—ö–µ
    }

    private string IsSelected(string culture)
    {
        var currentCulture = System.Globalization.CultureInfo.CurrentUICulture.Name; // –î–æ–±–∏—ò —ò–∞ —Ç–µ–∫–æ–≤–Ω–∞—Ç–∞ –∫—É–ª—Ç—É—Ä–∞
        return currentCulture.StartsWith(culture) ? "selected" : null; // –ê–∫–æ –µ –∏–∑–±—Ä–∞–Ω–∞ –∫—É–ª—Ç—É—Ä–∞, –≤—Ä–∞—Ç–∏ "selected"
    }
}

NAVMENU.RAZOR

@using BlazorAppPaginationClient.Resources
@using Microsoft.AspNetCore.Components
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<SharedResource> localizer
@inject NavigationManager Navigation

<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">@localizer["Taxi Rides"]</a>
        <button title="Navigation menu" @onclick="ToggleNavMenu">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</div>

<div class="@NavMenuCssClass" @onclick="ToggleNavMenu">
    <nav class="flex-column">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="taxiridesapp">
                <span class="oi oi-list-rich" aria-hidden="true"></span>
                @localizer["TaxiRides"]
            </NavLink>
        </div>
    </nav>
</div>

@code {
    private bool collapseNavMenu = true;

    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }
}


MAINLAYOUT.RAZOR 
@inherits LayoutComponentBase
@using BlazorAppPaginationClient.Shared

<PageTitle>BlazorAppPaginationClient</PageTitle>

<div class="page">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main>
        <div class="top-row px-4" style="display: flex; justify-content: space-between; align-items: center;">
            <a href="https://docs.microsoft.com/aspnet/" target="_blank">About</a>
            <LanguageSelector />
        </div>

        <article class="content px-4">
            @Body
        </article>
    </main>
</div>   

PAGINATEDDATA.RAZOR
@page "/taxiridesapp"
@using BlazorAppPaginationClient.Models
@using System.Text
@inject IJSRuntime JSRuntime
@inject HttpClient Http
@inject IStringLocalizer<SharedResource> L
@inject NavigationManager NavigationManager
@using BlazorAppPaginationClient.Resources
@using Microsoft.Extensions.Localization


<h3>@L["TaxiRides"]</h3>

<div class="controls-container">
    <div class="language-selector">
        <label>@L["Language"]</label>
        <select @onchange="OnLanguageChanged">
            <option value="en">English</option>
            <option value="mk">–ú–∞–∫–µ–¥–æ–Ω—Å–∫–∏</option>
            <option value="sr">–°—Ä–ø—Å–∫–∏</option>
        </select>
    </div>
    <div class="search-box">
        <label>@L["SearchLabel"]</label>
        <input type="text" @bind="SearchText" @bind:event="oninput" placeholder="@L["SearchPlaceholder"]" class="search-input" />
    </div>
    <div class="page-size-selector">
        <label>@L["PageSize"]</label>
        <select @bind="PageSize" @bind:event="onchange" class="dropdown">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
            <option value="100">100</option>
        </select>
    </div>
    <div class="total-records">
        <strong>@L["TotalRecords"] @FilteredRecords</strong>
    </div>
</div>

@if (TaxiRecords == null)
{
    <p>@L["Loading"]...</p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>#</th>
                @foreach (var property in typeof(TaxiRecord).GetProperties())
                {
                    <th @onclick="() => SortByColumn(property.Name)" class="sortable">
                        @property.Name @GetSortIndicator(property.Name)
                    </th>
                }
            </tr>
        </thead>
        <tbody>
            @foreach (var (ride, index) in PaginatedRides.Select((r, i) => (r, i + 1 + ((_currentPage - 1) * PageSize))))
            {
                <tr>
                    <td>@index</td>
                    @foreach (var property in typeof(TaxiRecord).GetProperties())
                    {
                        <td>@property.GetValue(ride)</td>
                    }
                </tr>
            }
        </tbody>
    </table>

    <div class="pagination-container">
        <button @onclick="PreviousPage" disabled="@(_currentPage == 1)" class="pagination-button">@L["Previous"]</button>
        <span>@L["Page"] @_currentPage @L["Of"] @TotalPages</span>
        <button @onclick="NextPage" disabled="@(_currentPage >= TotalPages)" class="pagination-button">@L["Next"]</button>
    </div>

    <div class="page-input-container">
        <label>@L["EnterPage"]</label>
        <input type="number" @bind="EnteredPage" class="page-input" />
        <button @onclick="GoToPage" class="pagination-button">@L["Go"]</button>
    </div>

    <div class="export-buttons">
        <button class="btn btn-primary" @onclick="ExportToCsv">@L["ExportCsv"]</button>
        <button class="btn btn-success" @onclick="ExportToExcel">@L["ExportExcel"]</button>
        <button class="btn btn-danger" @onclick="ExportToPdf">@L["ExportPdf"]</button>
    </div>
}

<style>
    .controls-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        gap: 10px;
    }

    .search-input, .dropdown, .page-input {
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

        .table th, .table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

    .sortable:hover {
        cursor: pointer;
        background-color: #f1f1f1;
    }

    .pagination-container, .page-input-container {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 10px;
        gap: 10px;
    }

    .pagination-button {
        padding: 5px 10px;
        border: none;
        background-color: #007bff;
        color: white;
        border-radius: 5px;
        cursor: pointer;
    }

        .pagination-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

    .export-buttons {
        margin-top: 15px;
        text-align: center;
    }
</style>

@code {
    private List<TaxiRecord> TaxiRecords = new();
    private string SearchText = "";
    private int _currentPage = 1;
    private int PageSize = 10;
    private int EnteredPage;
    private int TotalRecords = 0;
    private int FilteredRecords => FilteredRides.Count;
    private int TotalPages => (int)Math.Ceiling((double)FilteredRecords / PageSize);

    private string SortColumn = nameof(TaxiRecord.pickupTime);
    private bool SortAscending = true;

    private List<TaxiRecord> FilteredRides =>
        string.IsNullOrWhiteSpace(SearchText)
        ? TaxiRecords
        : TaxiRecords.Where(r => typeof(TaxiRecord).GetProperties()
            .Any(p => p.GetValue(r)?.ToString()?.Contains(SearchText, StringComparison.OrdinalIgnoreCase) == true)).ToList();

    private List<TaxiRecord> PaginatedRides =>
        FilteredRides
        .OrderBy(r => SortAscending ? GetPropertyValue(r, SortColumn) : null)
        .ThenByDescending(r => SortAscending ? null : GetPropertyValue(r, SortColumn))
        .Skip((_currentPage - 1) * PageSize)
        .Take(PageSize)
        .ToList();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            TaxiRecords = await Http.GetFromJsonAsync<List<TaxiRecord>>("http://localhost:5098/api/TaxiRides/GetTaxiRides2");
            TotalRecords = TaxiRecords.Count;
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error: {ex.Message}");
        }
    }

    private void NextPage()
    {
        if (_currentPage < TotalPages) _currentPage++;
    }

    private void PreviousPage()
    {
        if (_currentPage > 1) _currentPage--;
    }

    private void GoToPage()
    {
        if (EnteredPage >= 1 && EnteredPage <= TotalPages)
        {
            _currentPage = EnteredPage;
        }
    }

    private void SortByColumn(string columnName)
    {
        if (SortColumn == columnName)
        {
            SortAscending = !SortAscending;
        }
        else
        {
            SortColumn = columnName;
            SortAscending = true;
        }
    }

    private string GetSortIndicator(string columnName)
    {
        if (SortColumn == columnName)
        {
            return SortAscending ? "‚ñ≤" : "‚ñº";
        }
        return "";
    }

    private object GetPropertyValue(TaxiRecord ride, string propertyName)
    {
        var property = typeof(TaxiRecord).GetProperty(propertyName);
        return property?.GetValue(ride, null);
    }

    private async Task ExportToCsv()
    {
        var csvContent = GenerateCsvContent(PaginatedRides);
        await JSRuntime.InvokeVoidAsync("saveAsFile", "taxi_rides.csv", csvContent);
    }

    private async Task ExportToExcel()
    {
        var excelContent = GenerateExcelContent(PaginatedRides);
        await JSRuntime.InvokeVoidAsync("saveExcel", "taxi_rides.xlsx", excelContent);
    }

    private async Task ExportToPdf()
    {
        var pdfContent = GeneratePdfContent(PaginatedRides);
        await JSRuntime.InvokeVoidAsync("savePdf", "taxi_rides.pdf", pdfContent);
    }

    private string GenerateCsvContent(List<TaxiRecord> data)
    {
        var sb = new StringBuilder();
        sb.AppendLine("Medallion,Hash License,Pickup Time,Drop-off Time,Duration,Distance,Pickup Longitude,Pickup Latitude,Drop-off Longitude,Drop-off Latitude,Payment Type,Fare Amount,Surcharge,Tax,Tip Amount,Tolls Amount,Total Amount");

        foreach (var item in data)
        {
            sb.AppendLine($"{item.medallion},{item.hashLicense},{item.pickupTime},{item.dropOffTime},{item.duration},{item.distance},{item.pLongitude},{item.pLatitude},{item.dLongitude},{item.dLatitude},{item.paymentType},{item.fareAmount},{item.surcharge},{item.tax},{item.tipAmount},{item.tollsAmount},{item.totalAmount}");
        }

        return sb.ToString();
    }

    private object GenerateExcelContent(List<TaxiRecord> data)
    {
        var sheet = new List<List<object>> {
            new List<object> { "Medallion", "Hash License", "Pickup Time", "Drop-off Time", "Duration", "Distance", "Pickup Longitude", "Pickup Latitude", "Drop-off Longitude", "Drop-off Latitude", "Payment Type", "Fare Amount", "Surcharge", "Tax", "Tip Amount", "Tolls Amount", "Total Amount" }
        };

        foreach (var item in data)
        {
            sheet.Add(new List<object> { item.medallion, item.hashLicense, item.pickupTime, item.dropOffTime, item.duration, item.distance, item.pLongitude, item.pLatitude, item.dLongitude, item.dLatitude, item.paymentType, item.fareAmount, item.surcharge, item.tax, item.tipAmount, item.tollsAmount, item.totalAmount });
        }

        return sheet;
    }

    private string GeneratePdfContent(List<TaxiRecord> data)
    {
        var content = "Taxi Ride Data:\n\n";
        foreach (var item in data)
        {
            content += $"Medallion: {item.medallion}, Hash License: {item.hashLicense}, Pickup: {item.pickupTime}, Drop-off: {item.dropOffTime}, Total Amount: {item.totalAmount}\n";
        }
        return content;
    }

    private async Task OnLanguageChanged(ChangeEventArgs e)
    {
        var selectedCulture = e.Value?.ToString() ?? "en";
        var uri = new Uri(NavigationManager.Uri).GetComponents(UriComponents.PathAndQuery, UriFormat.Unescaped);
        var newUri = $"{uri}?culture={selectedCulture}&ui-culture={selectedCulture}";
        NavigationManager.NavigateTo(newUri, forceLoad: true);
    }
}

